<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://unpkg.com/video.js/dist/video-js.min.css" rel="stylesheet">
    <script src="https://unpkg.com/video.js/dist/video.min.js"></script>
    <title>IPTV Player with Channel Selection</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
        }
        #my-player {
            margin: 20px auto;
            width: 640px;
            height: 360px;
        }
    </style>
</head>
<body>
    <h1>IPTV Player</h1>
    <select id="channel-select">
        <option value="">Select a channel</option>
    </select>
    <video id="my-player" class="video-js vjs-default-skin" controls preload="auto" data-setup='{}'>
        <source src="" type="application/x-mpegURL">
        <p class="vjs-no-js">
            To view this video please enable JavaScript, and consider upgrading to a 
            <a href="https://videojs.com/html5-video-support/" target="_blank">web browser that supports HTML5 video</a>
        </p>
    </video>

    <script>
        const m3uUrl = 'https://gabrieliptv.netlify.app/playlist.m3u'; // Your M3U URL
        const channelSelect = document.getElementById('channel-select');
        const player = videojs('my-player');

        // Fetch M3U playlist
        fetch(m3uUrl)
            .then(response => response.text())
            .then(data => {
                const lines = data.split('\n');
                let currentChannel = '';

                lines.forEach(line => {
                    if (line.startsWith('#EXTINF')) {
                        const channelInfo = line.split(',');
                        const channelName = channelInfo[1].trim();
                        currentChannel = lines[lines.indexOf(line) + 1]; // Next line is the stream URL
                        const option = document.createElement('option');
                        option.value = currentChannel;
                        option.textContent = channelName;
                        channelSelect.appendChild(option);
                    }
                });
            });

        // Load selected channel
        channelSelect.addEventListener('change', function() {
            const selectedChannel = this.value;
            if (selectedChannel) {
                player.src({ src: selectedChannel, type: 'application/x-mpegURL' });
                player.play();
            }
        });
    </script>
</body>
</html>
