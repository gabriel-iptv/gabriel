<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GABRIELIPTV</title>
    <style>
        /* Keep your existing styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            background-color: #fff;
        }

        .menu-overlay {
            /* Your existing styles */
        }

        .player-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            width: 100%;
            height: 100%;
        }

        #player {
            width: 100%;
            height: 100%;
            background-color: #000;
        }

        .menu-button, .fullscreen-button {
            /* Your existing styles */
        }
    </style>
    <!-- Include Shaka Player Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.1/shaka-player.min.js"></script>
    <script src="channels.js"></script>
    <script>
        let playerInstance;
        let currentChannelName = "";

        async function loadStream(channelKey) {
            const channel = channels[channelKey];
            currentChannelName = channelKey;

            const playerContainer = document.getElementById("player");
            const isYoutube = channel.type === "youtube";

            if (isYoutube) {
                playerContainer.innerHTML = `
                    <iframe
                        id="youtube-player"
                        src="${channel.url}"
                        frameborder="0"
                        allow="autoplay; fullscreen"
                        allowfullscreen
                        width="100%"
                        height="100%"
                    ></iframe>
                `;
            } else {
                // Clear previous player instance
                if (playerInstance) {
                    playerInstance.unload().catch(console.error);
                }

                // Set up Shaka Player
                const videoElement = document.createElement("video");
                videoElement.id = "shaka-player";
                videoElement.width = "100%";
                videoElement.height = "100%";
                videoElement.autoplay = true;
                videoElement.controls = true;

                // Remove old children and append the new player
                playerContainer.innerHTML = "";
                playerContainer.appendChild(videoElement);

                playerInstance = new shaka.Player(videoElement);

                // DRM setup if needed
                if (channel.type === "mpd" && channel.keyId && channel.key) {
                    playerInstance.configure({
                        drm: {
                            clearKeys: {
                                [channel.keyId]: channel.key,
                            },
                        },
                    });
                }

                try {
                    await playerInstance.load(channel.url);
                    console.log("The video has been loaded successfully!");
                } catch (error) {
                    console.error("Error loading video:", error);
                }
            }

            // Highlight the active channel in the menu
            const channelItems = document.querySelectorAll(".menu-overlay li");
            channelItems.forEach((item) => item.classList.remove("active"));
            document.getElementById(channelKey).classList.add("active");

            // Close the menu automatically
            toggleMenu();
        }

        function toggleMenu() {
            const menuOverlay = document.querySelector(".menu-overlay");
            menuOverlay.classList.toggle("open");
        }

        function enterFullscreen() {
            const body = document.body;
            if (!document.fullscreenElement) {
                body.requestFullscreen().then(() => {
                    console.log("Entered fullscreen");
                });
            }
        }

        function exitFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen().then(() => {
                    console.log("Exited fullscreen");
                });
            }
        }

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                exitFullscreen();
            } else {
                enterFullscreen();
            }
        }

        window.onload = function () {
            // Load the first channel by default
            loadStream("tv5");
        };
    </script>
</head>
<body>
    <!-- Hamburger Menu Button -->
    <button class="menu-button" onclick="toggleMenu()">≡</button>

    <!-- Fullscreen Button -->
    <button class="fullscreen-button" onclick="toggleFullscreen()">⛶</button>

    <!-- Menu Overlay -->
    <div class="menu-overlay">
        <h2 id="current-channel">Channel List</h2>
        <ul>
            <li id="tv5" onclick="loadStream('tv5')">TV5</li>
            <li id="a2z" onclick="loadStream('a2z')">A2Z</li>
            <!-- Add other channels here -->
        </ul>
    </div>

    <!-- Player Container -->
    <div class="player-container">
        <div id="player"></div>
    </div>
</body>
</html>
